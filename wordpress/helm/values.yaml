## Global Configuration
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: "do-block-storage"

## Service Account Security
serviceAccount:
  create: true
  automount: false
  annotations: {}

# Pod Security Standards: Service Account Token Automount
automountServiceAccountToken: false

## Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  maxUnavailable: 1

## cert-manager Configuration  
certManager:
  email: "EMAIL_PLACEHOLDER"
  createClusterIssuer: false  # Use existing ClusterIssuer

## WordPress Configuration  
wordpress:
  enableMultisite: false
  
  ## WordPress Basic Settings
  wordpressUsername: admin
  wordpressEmail: ""  # Set via --set global.email or deploy script
  wordpressBlogName: "WordPress Site"
  wordpressScheme: https
  wordpressTablePrefix: "wp_"
  domain: ""  # Set via --set global.domain or deploy script
  includeWWW: false  # Automatically configure www subdomain for main domain
  redirectToWWW: false  # Redirect root domain to www subdomain (e.g., example.com → www.example.com)
  redirectFromWWW: false  # Redirect www subdomain to root domain (e.g., www.example.com → example.com)
  wordpressExtraWpConfigContent: |
    define('WP_CACHE', true);
    define('DISABLE_FILE_EDITING', true);
    define('DISALLOW_FILE_MODS', true);
    define('FORCE_SSL_ADMIN', true);
    define('WP_AUTO_UPDATE_CORE', true);
  
  ## Container Image Configuration
  image:
    registry: docker.io
    repository: wordpress
    tag: 6.8.3-php8.3-apache
    pullPolicy: IfNotPresent
  
  ## Storage Configuration
  persistence:
    enabled: true
    
  ## Security Keys (auto-generated)
  security:
    authKey: "CHANGE_ME_AUTH_KEY"
    secureAuthKey: "CHANGE_ME_SECURE_AUTH_KEY"
    loggedInKey: "CHANGE_ME_LOGGED_IN_KEY"
    nonceKey: "CHANGE_ME_NONCE_KEY"
    authSalt: "CHANGE_ME_AUTH_SALT"
    secureAuthSalt: "CHANGE_ME_SECURE_AUTH_SALT"
    loggedInSalt: "CHANGE_ME_LOGGED_IN_SALT"
    nonceSalt: "CHANGE_ME_NONCE_SALT"

## Zero-Trust NetworkPolicy (Enterprise Security)
networkPolicy:
  enabled: true
  policyTypes:
  - Ingress
  - Egress
  
  # Ingress: Only allow NGINX Ingress Controller and same namespace
  ingress:
  - from:
    # Allow NGINX Ingress Controller
    - namespaceSelector:
        matchLabels:
          name: ingress-nginx
    # Allow same namespace communication
    - namespaceSelector:
        matchLabels:
          kubernetes.io/metadata.name: wordpress
    ports:
    - protocol: TCP
      port: 80
    - protocol: TCP
      port: 443
  
  # Egress: Restricted to essential services only
  egress:
  # DNS resolution
  - to: []
    ports:
    - protocol: UDP
      port: 53
    - protocol: TCP
      port: 53
  # HTTPS for WordPress updates and plugins
  - to: []
    ports:
    - protocol: TCP
      port: 443
  # Allow communication with MariaDB and Redis in same namespace
  - to:
    - namespaceSelector:
        matchLabels:
          kubernetes.io/metadata.name: wordpress
    ports:
    - protocol: TCP
      port: 3306  # MariaDB
    - protocol: TCP
      port: 6379  # Redis

## Replica Configuration
replicaCount: 1

## WordPress Configuration
wordpress:
  image:
    registry: docker.io
    repository: wordpress
    tag: "6.8.3-php8.3-apache"
    pullPolicy: IfNotPresent
    pullSecrets: []

  ## WordPress Admin User (Configured via installation wizard)
  # Leave empty to enable WordPress installation wizard
  wordpressUsername: ""
  wordpressEmail: ""
  wordpressPassword: ""

  ## WordPress Site Configuration
  wordpressBlogName: "Enterprise WordPress Site"
  wordpressScheme: https
  domain: ""  # Set via --set global.domain or deploy script
  
  ## WordPress Extra WP Config Content
  wordpressExtraWpConfigContent: |
    // WordPress configuration
    define('WP_DEBUG', false);
    define('WP_DEBUG_LOG', false);
    define('WP_DEBUG_DISPLAY', false);
    define('AUTOMATIC_UPDATER_DISABLED', false);
    define('WP_AUTO_UPDATE_CORE', 'minor');
    define('DISALLOW_FILE_EDIT', true);
    define('FORCE_SSL_ADMIN', true);
    define('WP_MEMORY_LIMIT', '256M');
    
    // Disable WP-Cron (handled by Kubernetes CronJob)
    define('DISABLE_WP_CRON', true);
    
    // Performance optimizations
    define('WP_CACHE', true);
    define('WP_POST_REVISIONS', 3);
    define('AUTOSAVE_INTERVAL', 300);
    define('EMPTY_TRASH_DAYS', 7);
    
    // Security hardening
    ini_set('session.cookie_httponly', true);
    ini_set('session.cookie_secure', true);
    ini_set('session.use_only_cookies', true);
    
    // Enable object caching
    define('WP_CACHE_KEY_SALT', 'wordpress_cache_');
    
    // SMTP Configuration for reliable email delivery
    define('SMTP_FROM_EMAIL', 'EMAIL_PLACEHOLDER');
    define('SMTP_FROM_NAME', 'YOUR_NAME');
    
    // Enable WordPress mail debug logging
    define('WP_MAIL_DEBUG', false);
  
  ## WordPress Security Keys (Generated automatically by deployment script)
  security:
    authKey: "AUTH_KEY_PLACEHOLDER"
    secureAuthKey: "SECURE_AUTH_KEY_PLACEHOLDER"
    loggedInKey: "LOGGED_IN_KEY_PLACEHOLDER"
    nonceKey: "NONCE_KEY_PLACEHOLDER"
    authSalt: "AUTH_SALT_PLACEHOLDER"
    secureAuthSalt: "SECURE_AUTH_SALT_PLACEHOLDER"
    loggedInSalt: "LOGGED_IN_SALT_PLACEHOLDER"
    nonceSalt: "NONCE_SALT_PLACEHOLDER"

  ## Persistence Configuration
  persistence:
    enabled: true
    storageClass: "do-block-storage"
    accessModes:
      - ReadWriteOnce
    size: 8Gi
    coreSize: 4Gi  # WordPress core files persistence
    # Separate volumes for security
    volumes:
      content:
        mountPath: /var/www/html/wp-content
        size: 8Gi
      config:
        mountPath: /var/www/html/wp-config-custom
        size: 100Mi
      cache:
        mountPath: /var/cache/wordpress
        size: 1Gi

  ## Extra environment variables
  extraEnvVars:
  - name: WORDPRESS_ENABLE_REDIS
    value: "yes"  # Enable Redis since we re-enabled it
  - name: APACHE_HTTP_PORT
    value: "8080"
  - name: WORDPRESS_CONFIG_EXTRA
    value: |
      define('WP_CACHE', true);
      define('DISABLE_FILE_EDITING', true);
      define('DISALLOW_FILE_MODS', true);
      define('FORCE_SSL_ADMIN', true);
      define('WP_AUTO_UPDATE_CORE', true);

  ## Init Containers (WordPress Hardening) - Disabled for resource optimization
  initContainers:
    enabled: false
    securityContext:
      runAsUser: 1000
      runAsGroup: 1000
      runAsNonRoot: true

  ## Extra Init Containers for CI/CD wp-content sync
  extraInitContainers: []
  # Removed non-functional plugin installation
  # Plugins should be installed manually after deployment via WordPress admin
  # or WP-CLI for production environments

  ## WordPress Security Context (Production Ready)
  security:
    automountServiceAccountToken: false
    runAsUser: 0  # Required for Apache port 80 binding
    runAsGroup: 0
    runAsNonRoot: false
    fsGroup: 33  # www-data for file permissions
    readOnlyRootFilesystem: false
    allowPrivilegeEscalation: false
    capabilities: {}  # Use default capabilities for WordPress
    seccompProfile:
      type: RuntimeDefault

  ## Resource Configuration (WordPress Production Requirements - WeOwn Optimized)
  # Based on actual usage: WordPress uses ~380Mi in production
  resources:
    limits:
      cpu: 800m        # Sufficient for Kadence AI theme installation
      memory: 1Gi      # Prevents OOMKilled during plugin installs
      ephemeral-storage: 800Mi
    requests:
      cpu: 50m         # Cluster-optimized baseline
      memory: 384Mi    # Matches actual usage to prevent eviction (was 256Mi)
      ephemeral-storage: 200Mi
  ## Health Checks (Production Ready - TCP mode for iThemes Security compatibility)
  livenessProbe:
    enabled: true
    tcpSocket:
      port: 80
    initialDelaySeconds: 120
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 6
    successThreshold: 1
  
  readinessProbe:
    enabled: true
    tcpSocket:
      port: 80
    initialDelaySeconds: 60
    periodSeconds: 15
    timeoutSeconds: 10
    failureThreshold: 10
    successThreshold: 1

  ## Auto-scaling Configuration (Disabled for single replica + RWO volumes)
  autoscaling:
    enabled: false  # Must be false when using ReadWriteOnce volumes

## General Configuration
replicaCount: 1

## Redis Configuration (Production Caching)
redis:
  enabled: false  # Disabled for initial deployment
  auth:
    enabled: false

## Environment Variables
extraEnvVars: []

## Ingress Configuration
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    # TLS/SSL Security - Enterprise-grade encryption (configured in template)
    # force-ssl-redirect: "true"
    # ssl-protocols: "TLSv1.2 TLSv1.3"
    # ssl-ciphers: Modern cipher suites for mobile browser compatibility
    # WordPress Performance
    nginx.ingress.kubernetes.io/proxy-body-size: "64m"  # Allow large plugin/media uploads
  
  ## TLS Security Configuration (Parameterized for flexibility)
  tls:
    protocols: "TLSv1.2 TLSv1.3"  # Both for maximum compatibility (99.9% devices)
    # Cipher suites: Mozilla "Intermediate" profile - balances security with compatibility
    # Supports: Perfect Forward Secrecy, mobile devices (CHACHA20), modern encryption (AES-GCM)
    ciphers: "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305"
  hosts:
  - host: ""
    paths:
    - path: /
      pathType: Prefix
  tls:
  - secretName: wordpress-tls
    hosts: []

## Service Configuration
service:
  type: ClusterIP
  port: 80

## Cron Jobs (Production Maintenance)
cron:
  enabled: true
  schedule: "*/5 * * * *"  # Every 5 minutes (prevents action_scheduler delays)
  image:
    registry: docker.io
    repository: wordpress
    tag: 6.8.3-php8.3-apache
  resources:
    limits:
      cpu: 100m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 128Mi

## Backup Configuration (Production Critical)
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention: "30"  # 30 days
  resources:
    limits:
      cpu: 200m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi

## MariaDB Configuration (Official MariaDB 12.0.2 Latest Stable)
mariadb:
  enabled: false  # Using custom StatefulSet with official image

mariadbOfficial:
  enabled: true
  image: mariadb:12.0.2  # Official MariaDB Latest Stable - October 2025
  auth:
    database: wordpress
    username: wordpress
    password: "MARIADB_PASSWORD_PLACEHOLDER"
    rootPassword: "MARIADB_ROOT_PASSWORD_PLACEHOLDER"
  
  ## Security Context (Pod Security Standards: Restricted)
  podSecurityContext:
    runAsUser: 999  # Official MariaDB mysql user
    runAsGroup: 999
    runAsNonRoot: true
    fsGroup: 999
    seccompProfile:
      type: RuntimeDefault
  
  containerSecurityContext:
    runAsUser: 999  # Official MariaDB mysql user
    runAsGroup: 999
    runAsNonRoot: true
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop:
      - ALL
    seccompProfile:
      type: RuntimeDefault
  
  ## Resource Configuration (MariaDB Memory-Optimized - WeOwn Standardized)
  resources:
    limits:
      cpu: 250m        # Optimized for database operations
      memory: 512Mi    # Increased for initialization (prevents OOMKilled)
      ephemeral-storage: 1Gi
    requests:
      cpu: 50m         # Matches cluster optimization
      memory: 256Mi    # Increased for initialization stability
  
  ## MariaDB Performance Tuning (2-node cluster optimized)
  configuration: |
    [mysqld]
    innodb_buffer_pool_size=64M   # Reduced for memory efficiency
    innodb_log_file_size=16M  # Reduced for faster startup
    query_cache_size=16M      # Reduced but still beneficial
    query_cache_limit=1M      # Conservative limit
    thread_cache_size=4       # Fewer threads for 2-node
    table_open_cache=128      # Reduced cache size
    performance_schema=OFF    # Keep disabled for efficiency
    innodb_flush_log_at_trx_commit=2  # Better performance

## Redis Cache Configuration (Lightweight for 2-node cluster)
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: true
    password: "REDIS_PASSWORD_PLACEHOLDER"
  
  ## Resource limits for 2-node efficiency
  master:
    resources:
      limits:
        cpu: 50m
        memory: 48Mi
        ephemeral-storage: 150Mi
      requests:
        cpu: 10m
        memory: 24Mi
        ephemeral-storage: 50Mi
    
    persistence:
      enabled: false  # Disabled for performance in 2-node cluster
    
    ## Security context for Redis
    podSecurityContext:
      runAsUser: 1001
      runAsGroup: 1001
      runAsNonRoot: true
      fsGroup: 1001
      seccompProfile:
        type: RuntimeDefault
    
    containerSecurityContext:
      runAsUser: 1001
      runAsGroup: 1001
      runAsNonRoot: true
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: false
      capabilities:
        drop:
        - ALL
      seccompProfile:
        type: RuntimeDefault

## Service Configuration
service:
  type: ClusterIP  # Secure internal-only access
  port: 80
  targetPort: 80
  annotations: {}


## NetworkPolicy (Zero-Trust Security)
networkPolicy:
  enabled: false
  policyTypes:
  - Ingress
  - Egress
  
  ingress:
    # Allow NGINX Ingress Controller
    - from:
      - namespaceSelector:
          matchLabels:
            name: ingress-nginx
      - podSelector:
          matchLabels: {}
      ports:
      - protocol: TCP
        port: 8080
  egress:
    # Allow DNS resolution to kube-system namespace only
    - to:
      - namespaceSelector:
          matchLabels:
            name: kube-system
      ports:
      - protocol: UDP
        port: 53
      - protocol: TCP
        port: 53
    # Allow HTTPS outbound for WordPress updates/plugins
    - to: []
      ports:
      - protocol: TCP
        port: 443
    # Allow access to MariaDB
    - to:
      - podSelector:
          matchLabels:
            app.kubernetes.io/name: mariadb
      ports:
      - protocol: TCP
        port: 3306
    # Allow access to Redis (if enabled)
    - to:
      - podSelector:
          matchLabels:
            app.kubernetes.io/name: redis
      ports:
      - protocol: TCP
        port: 6379

## Backup Configuration (NEW - Enhanced Data Protection)
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention: 30  # Keep 30 days of backups
  storage:
    size: 20Gi
    storageClass: "do-block-storage"

## Monitoring & Observability
monitoring:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 30s
    path: /wp-json/wp/v2/
    port: http

## Must-Use Plugins Configuration
muPlugins:
  cache:
    enabled: true
  authFix:
    enabled: true   # General REST API Authentication fix for containerized environments
  disableXmlRpc:
    enabled: true   # Security best practice: Disable XML-RPC (use REST API instead)
  smtp:
    enabled: true   # Enterprise SMTP Configuration via Environment Variables

## WordPress Plugins (Manual Installation Recommended)
# Plugins are not pre-configured in this deployment for security and flexibility
# Install plugins manually after deployment via:
# 1. WordPress Admin > Plugins > Add New
# 2. WP-CLI: kubectl exec deployment/wordpress -n namespace -- wp plugin install plugin-name
# 3. Manual upload via WordPress Admin
#
# Recommended plugins for enterprise use:
# Security: wordfence, limit-login-attempts, wp-security-audit-log
# Performance: w3-total-cache, smush, shortpixel-image-optimiser
# SEO: yoast-seo, rankmath-seo
# Backup: updraftplus, backwpup
#
# plugins:
#   security:
#     - wordfence
#     - limit-login-attempts
#   performance:
#     - w3-total-cache
#     - smush
#   seo:
#     - yoast-seo
